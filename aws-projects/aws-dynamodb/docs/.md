# 🛠️ **DynamoDB Create Operations (CRUD - Create)**

Creating an item in **DynamoDB** involves **writing data** into a table using `PutItem` or `BatchWriteItem` operations. DynamoDB ensures **high availability, scalability, and durability** by distributing and replicating data across multiple partitions and availability zones.

---

## 📊 **Table Metadata in DynamoDB**

### 📌 **What is Table Metadata?**

Every **DynamoDB table** has **metadata** that stores key information, including:

✅ **Primary Key Structure:** Defines **Partition Key (PK)** and **Sort Key (SK)**.  
✅ **Partition Mapping:** Maps **hashed Partition Keys to physical partitions**.  
✅ **Item Placement:** Determines which partition stores a specific item.  
✅ **Replication Info:** Maintains **replication data** across availability zones.

### 🔍 **Metadata Structure Example**

📌 **Table Definition:**

| Attribute           | Type              | Description                             |
| ------------------- | ----------------- | --------------------------------------- |
| `Partition Key`     | String            | Used for partition hashing              |
| `Sort Key`          | String (Optional) | Orders items within a partition         |
| `Attributes`        | JSON              | Other item attributes                   |
| `Storage Partition` | String            | The physical partition storing the item |
| `Replication Group` | String            | Defines replication across AZs          |

---

## 🔄 **How DynamoDB Maps Items to Partitions**

### 📌 **Partitioning Process**

1️⃣ **DynamoDB takes the Partition Key (PK)** and **hashes** it.  
2️⃣ **It checks the metadata** to find the **mapped partition**.  
3️⃣ If the partition exists, the item is **inserted/updated** in that partition.  
4️⃣ If the partition **does not exist**, it creates a **new partition**.

---

## 🔍 **How Metadata Maps Partition Keys to Partitions**

DynamoDB uses **metadata to track partitions**. Below is an example of a **hash-to-partition mapping**:

| **Partition Key (PK) Hash** | **Partition ID** | **Physical Location** |
| --------------------------- | ---------------- | --------------------- |
| Hash-A (PK: `User123`)      | Partition-1      | AZ-a                  |
| Hash-B (PK: `Order456`)     | Partition-2      | AZ-b                  |
| Hash-C (PK: `Product789`)   | Partition-3      | AZ-c                  |

📌 **Hash-A** represents the hashed value of `User123`'s Partition Key, which is mapped to **Partition-1**.

---

## 📜 **Sequence Diagram: Writing an Item with Metadata Lookup**

Below is a **Mermaid.js sequence diagram** that illustrates the **workflow of writing an item in DynamoDB**:

```mermaid
sequenceDiagram
    participant Client as Client (AWS CLI/SDK)
    participant DynamoDB as DynamoDB
    participant Metadata as Metadata Service
    participant Partition as Physical Partition

    Client->>DynamoDB: PutItem Request (PK: "User123", Data)
    DynamoDB->>Metadata: Lookup Hash of Partition Key ("User123")
    Metadata-->>DynamoDB: Partition Found (Partition-1)
    DynamoDB->>Partition: Write Item to Partition-1
    Partition-->>DynamoDB: Write Successful
    DynamoDB-->>Client: Success Response (200 OK)
```

---

## 🏗️ **Under-the-Hood Process for Writing an Item**

### 🔹 **Step-by-Step Workflow**

1️⃣ **Client sends a `PutItem` request** to DynamoDB with the item’s data.  
2️⃣ **DynamoDB hashes the Partition Key** and queries the **metadata service** for partition mapping.  
3️⃣ **Metadata service checks if the partition exists:**

- ✅ **If partition exists** → DynamoDB routes the write request to the partition.
- ❌ **If partition does not exist** → DynamoDB creates a new partition.  
  4️⃣ **DynamoDB writes the item into the partition** and updates the **replication group**.  
  5️⃣ **The operation completes**, and DynamoDB sends a **success response** to the client.

📌 **Example Hash Calculation (Simplified Example)**

```plaintext
Partition Key: "User123"
Hash Function Applied: SHA-256("User123")
Resulting Hash: 0xA9B3F2
Mapped Partition: Partition-1 (AZ-a)
```

---

## 🔥 **Key Takeaways**

✅ **DynamoDB uses a metadata service** to manage **Partition Key to partition mappings**.  
✅ **Metadata tracks partitions, sort keys, and replication** across multiple availability zones.  
✅ **Writes are atomic** and automatically distributed for **high availability**.  
✅ **Hashing ensures even distribution**, preventing **hot partitions**.  
✅ **Sequence diagrams help visualize** how DynamoDB handles writes **under the hood**.

By understanding **how DynamoDB manages metadata**, you can optimize your **database design for efficiency and scalability**. 🚀
