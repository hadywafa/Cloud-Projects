# üî• **What is a Global Secondary Index (GSI) in DynamoDB?**

A **Global Secondary Index (GSI)** in DynamoDB is **a separate index that allows querying data using a different attribute than the primary key (PK & SK).** It enables **fast lookups** without scanning the entire table.

---

## üìå **Why Do We Need GSIs?**

By default, DynamoDB **only allows queries using the primary key** (Partition Key `PK` and optionally Sort Key `SK`).  
But what if we need to:

- Retrieve all **orders for a specific user**?
- Find **products by category**?
- Search for **transactions by customer ID**?

Since the primary key **cannot be changed**, we create a **GSI**, which allows us to query using a different key.

---

## üéØ **How GSIs Work**

A **GSI is a copy of the table** that:
‚úÖ Uses **a different partition key** than the main table.  
‚úÖ Supports **querying by non-primary key attributes**.  
‚úÖ Is **automatically updated** when the base table changes.

---

### üèó **Example Without GSI: Querying Orders by UserID Fails**

Imagine we have the following **Orders table**:

| **PK (Primary Key)** | **SK (Sort Key)** | **UserID** | **Amount** |
| -------------------- | ----------------- | ---------- | ---------- |
| `ORDER#1001`         | `DETAILS`         | `USR001`   | `$50`      |
| `ORDER#1002`         | `DETAILS`         | `USR001`   | `$30`      |
| `ORDER#1003`         | `DETAILS`         | `USR002`   | `$100`     |

If we try to **query all orders by `UserID = "USR001"`**, it will fail because:
1Ô∏è‚É£ **DynamoDB only allows querying by PK (ORDER#ID)**.  
2Ô∏è‚É£ **UserID is not part of the primary key**, so we cannot filter directly.

---

### ‚úÖ **Solution: Create a GSI on `UserID`**

We define a **GSI** with:

- **Partition Key:** `UserID`
- **Sort Key:** `OrderID`

This allows us to **query orders by UserID efficiently**.

| **PK (Primary Key)** | **SK (Sort Key)** | **UserID (GSI PK)** | **OrderID (GSI SK)** | **Amount** |
| -------------------- | ----------------- | ------------------- | -------------------- | ---------- |
| `ORDER#1001`         | `DETAILS`         | `USR001`            | `1001`               | `$50`      |
| `ORDER#1002`         | `DETAILS`         | `USR001`            | `1002`               | `$30`      |
| `ORDER#1003`         | `DETAILS`         | `USR002`            | `1003`               | `$100`     |

Now we can:

```sh
Query all orders where UserID = "USR001"
```

‚úÖ DynamoDB **retrieves results instantly** using the GSI **instead of scanning the table**.

---

## üöÄ **How to Create a GSI (AWS CLI & Python)**

### **Step 1: Create a Table with GSI (AWS CLI)**

```sh
aws dynamodb create-table \
    --table-name Orders \
    --attribute-definitions \
        AttributeName=PK,AttributeType=S \
        AttributeName=SK,AttributeType=S \
        AttributeName=UserID,AttributeType=S \
        AttributeName=OrderID,AttributeType=S \
    --key-schema \
        AttributeName=PK,KeyType=HASH \
        AttributeName=SK,KeyType=RANGE \
    --global-secondary-indexes \
        "[{
            \"IndexName\": \"UserOrdersIndex\",
            \"KeySchema\": [
                {\"AttributeName\": \"UserID\", \"KeyType\": \"HASH\"},
                {\"AttributeName\": \"OrderID\", \"KeyType\": \"RANGE\"}
            ],
            \"Projection\": {\"ProjectionType\": \"ALL\"},
            \"ProvisionedThroughput\": {\"ReadCapacityUnits\": 5, \"WriteCapacityUnits\": 5}
        }]" \
    --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5
```

‚úÖ **This creates a GSI (`UserOrdersIndex`) to enable fast lookups by UserID.**

---

### **Step 2: Insert Data (AWS CLI & Python)**

#### **AWS CLI**

```sh
aws dynamodb put-item --table-name Orders --item '{
    "PK": {"S": "ORDER#1001"},
    "SK": {"S": "DETAILS"},
    "UserID": {"S": "USR001"},
    "OrderID": {"S": "1001"},
    "Amount": {"N": "50"}
}'

aws dynamodb put-item --table-name Orders --item '{
    "PK": {"S": "ORDER#1002"},
    "SK": {"S": "DETAILS"},
    "UserID": {"S": "USR001"},
    "OrderID": {"S": "1002"},
    "Amount": {"N": "30"}
}'
```

‚úÖ **Orders now have `UserID` indexed for lookup.**

---

### **Step 3: Query Data by GSI**

#### **AWS CLI: Get Orders for a User**

```sh
aws dynamodb query --table-name Orders \
    --index-name UserOrdersIndex \
    --key-condition-expression "UserID = :userid" \
    --expression-attribute-values '{":userid": {"S": "USR001"}}'
```

‚úÖ **Fetches all orders for `USR001` using the GSI.**

---

#### **Python: Query Orders by UserID**

```python
import boto3

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('Orders')

response = table.query(
    IndexName='UserOrdersIndex',
    KeyConditionExpression="UserID = :userid",
    ExpressionAttributeValues={":userid": {"S": "USR001"}}
)

for item in response['Items']:
    print(item)
```

‚úÖ **Efficiently retrieves orders without scanning the table.**

---

## üéØ **Final Takeaways**

‚úÖ **DynamoDB GSIs allow fast lookups using non-primary key attributes.**  
‚úÖ **They prevent full table scans and improve performance.**  
‚úÖ **Use GSIs when queries require filtering by attributes that are not the primary key.**  
‚úÖ **They work like a "secondary table" automatically synced with the main table.**

üî• **Now you understand GSIs! Want more real-world examples? Let me know!** üöÄ
